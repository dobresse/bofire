import numpy as np
import pandas as pd
from tqdm import trange

import bofire.strategies.api as strats
from bofire.benchmarks.api import Multinormalpdfs
from bofire.data_models.strategies.api import RandomStrategy, SoboStrategy


def mvnorm_params():
    cov1 = np.array(
        [
            [
                1.00000000e00,
                -9.81879820e-02,
                -3.23294971e-01,
                -2.41397440e-01,
                -2.11345542e-01,
                -3.94168498e-01,
                -8.54169896e-02,
                -2.74867996e-01,
                4.03804613e-01,
                -3.78892320e-01,
                3.07617317e-01,
                3.67659685e-01,
                3.44931519e-01,
                -2.02096930e-01,
                -4.06767898e-01,
                3.22708233e-01,
                -3.46026704e-01,
                1.63414758e-01,
                -2.47552109e-01,
                -3.40912607e-01,
            ],
            [
                -9.81879820e-02,
                1.00000000e00,
                9.45566060e-02,
                3.11089889e-01,
                3.92129631e-01,
                4.15989851e-01,
                1.37157722e-01,
                1.13372927e-01,
                -1.63356898e-01,
                2.93718873e-01,
                -2.63747738e-01,
                -2.44583955e-01,
                -2.91486342e-01,
                -2.98818561e-01,
                3.38493196e-01,
                -3.53535778e-01,
                2.07036790e-02,
                -2.49555102e-01,
                3.62540942e-01,
                2.20284497e-01,
            ],
            [
                -3.23294971e-01,
                9.45566060e-02,
                1.00000000e00,
                1.11005724e-01,
                -2.94226025e-01,
                7.35311347e-03,
                6.40532162e-02,
                -1.23845730e-01,
                1.91803607e-01,
                7.91803492e-02,
                -2.03863348e-01,
                2.03674631e-01,
                1.63913343e-01,
                1.75248228e-01,
                2.00565063e-01,
                6.26485333e-02,
                1.38999676e-01,
                -1.14709293e-01,
                -1.01355483e-01,
                5.13063482e-02,
            ],
            [
                -2.41397440e-01,
                3.11089889e-01,
                1.11005724e-01,
                1.00000000e00,
                3.16034514e-01,
                3.95756249e-01,
                9.64061480e-03,
                -1.62560820e-02,
                -2.23385607e-01,
                3.24580686e-01,
                -2.02356437e-01,
                3.90652833e-04,
                -5.03669355e-01,
                -6.68494260e-02,
                1.88056089e-01,
                -3.53306312e-01,
                4.41423047e-01,
                -2.27744028e-01,
                4.76617773e-02,
                4.58181374e-01,
            ],
            [
                -2.11345542e-01,
                3.92129631e-01,
                -2.94226025e-01,
                3.16034514e-01,
                1.00000000e00,
                3.57956485e-01,
                2.99904677e-01,
                3.57679558e-01,
                -7.32388057e-01,
                2.06197608e-01,
                -4.18005281e-01,
                -4.92938427e-01,
                -3.58403118e-01,
                -6.77454426e-02,
                2.09392294e-01,
                -2.05154563e-01,
                6.37629814e-02,
                -1.84906916e-01,
                3.48045991e-01,
                4.70362030e-01,
            ],
            [
                -3.94168498e-01,
                4.15989851e-01,
                7.35311347e-03,
                3.95756249e-01,
                3.57956485e-01,
                1.00000000e00,
                -5.48883204e-02,
                -6.84781993e-02,
                -3.48226284e-01,
                8.89608392e-02,
                -3.07066300e-01,
                -2.91259579e-01,
                -1.91393886e-01,
                -2.83246533e-01,
                -8.89973992e-02,
                -5.41390319e-01,
                1.62805289e-01,
                9.43020279e-02,
                4.30958206e-01,
                6.99689991e-02,
            ],
            [
                -8.54169896e-02,
                1.37157722e-01,
                6.40532162e-02,
                9.64061480e-03,
                2.99904677e-01,
                -5.48883204e-02,
                1.00000000e00,
                2.27959560e-01,
                -4.72515568e-01,
                -9.46347543e-02,
                -9.59628345e-02,
                -8.35129263e-02,
                -2.41508745e-01,
                3.35574316e-01,
                3.12437616e-01,
                1.45847825e-01,
                2.86694276e-02,
                -1.96550210e-01,
                8.78434377e-02,
                1.19392158e-01,
            ],
            [
                -2.74867996e-01,
                1.13372927e-01,
                -1.23845730e-01,
                -1.62560820e-02,
                3.57679558e-01,
                -6.84781993e-02,
                2.27959560e-01,
                1.00000000e00,
                -2.16011424e-01,
                3.38513047e-01,
                -3.58475312e-01,
                2.29981175e-02,
                -2.55063812e-01,
                2.76878738e-01,
                4.26997396e-01,
                -2.18369102e-01,
                1.29289860e-01,
                -4.40312384e-01,
                1.81368037e-01,
                2.65814422e-01,
            ],
            [
                4.03804613e-01,
                -1.63356898e-01,
                1.91803607e-01,
                -2.23385607e-01,
                -7.32388057e-01,
                -3.48226284e-01,
                -4.72515568e-01,
                -2.16011424e-01,
                1.00000000e00,
                -1.32466431e-01,
                3.59547395e-01,
                4.48452335e-01,
                3.21907850e-01,
                -1.59292076e-01,
                -1.33691881e-01,
                3.18315005e-01,
                -1.79570895e-01,
                2.16028037e-01,
                -3.88521216e-01,
                -3.15042467e-01,
            ],
            [
                -3.78892320e-01,
                2.93718873e-01,
                7.91803492e-02,
                3.24580686e-01,
                2.06197608e-01,
                8.89608392e-02,
                -9.46347543e-02,
                3.38513047e-01,
                -1.32466431e-01,
                1.00000000e00,
                -3.03818337e-01,
                -1.16783522e-01,
                -4.39280834e-01,
                1.74586557e-01,
                3.04057018e-01,
                -2.01220511e-01,
                1.55970174e-01,
                -1.42197171e-01,
                -5.26129647e-02,
                4.21461074e-01,
            ],
            [
                3.07617317e-01,
                -2.63747738e-01,
                -2.03863348e-01,
                -2.02356437e-01,
                -4.18005281e-01,
                -3.07066300e-01,
                -9.59628345e-02,
                -3.58475312e-01,
                3.59547395e-01,
                -3.03818337e-01,
                1.00000000e00,
                3.06419539e-01,
                3.69666154e-01,
                -3.86582640e-02,
                -2.11340192e-01,
                3.22110792e-01,
                -1.64331465e-01,
                1.96232506e-01,
                -3.61849567e-01,
                5.49269654e-02,
            ],
            [
                3.67659685e-01,
                -2.44583955e-01,
                2.03674631e-01,
                3.90652833e-04,
                -4.92938427e-01,
                -2.91259579e-01,
                -8.35129263e-02,
                2.29981175e-02,
                4.48452335e-01,
                -1.16783522e-01,
                3.06419539e-01,
                1.00000000e00,
                3.03829473e-01,
                3.20834960e-01,
                4.93675767e-02,
                1.96538900e-01,
                -8.23595422e-02,
                3.83250002e-02,
                -3.68925912e-01,
                -1.84436096e-01,
            ],
            [
                3.44931519e-01,
                -2.91486342e-01,
                1.63913343e-01,
                -5.03669355e-01,
                -3.58403118e-01,
                -1.91393886e-01,
                -2.41508745e-01,
                -2.55063812e-01,
                3.21907850e-01,
                -4.39280834e-01,
                3.69666154e-01,
                3.03829473e-01,
                1.00000000e00,
                1.59737045e-01,
                -2.65243051e-01,
                3.50572401e-01,
                -9.45080414e-02,
                1.71282557e-01,
                -2.65462546e-01,
                -3.73823778e-01,
            ],
            [
                -2.02096930e-01,
                -2.98818561e-01,
                1.75248228e-01,
                -6.68494260e-02,
                -6.77454426e-02,
                -2.83246533e-01,
                3.35574316e-01,
                2.76878738e-01,
                -1.59292076e-01,
                1.74586557e-01,
                -3.86582640e-02,
                3.20834960e-01,
                1.59737045e-01,
                1.00000000e00,
                4.11292893e-01,
                4.17103599e-01,
                1.76337462e-01,
                -2.12190569e-01,
                -1.71906089e-01,
                -8.55091437e-02,
            ],
            [
                -4.06767898e-01,
                3.38493196e-01,
                2.00565063e-01,
                1.88056089e-01,
                2.09392294e-01,
                -8.89973992e-02,
                3.12437616e-01,
                4.26997396e-01,
                -1.33691881e-01,
                3.04057018e-01,
                -2.11340192e-01,
                4.93675767e-02,
                -2.65243051e-01,
                4.11292893e-01,
                1.00000000e00,
                1.03444363e-01,
                2.84480391e-01,
                -1.79624039e-01,
                1.01408053e-03,
                5.30854724e-02,
            ],
            [
                3.22708233e-01,
                -3.53535778e-01,
                6.26485333e-02,
                -3.53306312e-01,
                -2.05154563e-01,
                -5.41390319e-01,
                1.45847825e-01,
                -2.18369102e-01,
                3.18315005e-01,
                -2.01220511e-01,
                3.22110792e-01,
                1.96538900e-01,
                3.50572401e-01,
                4.17103599e-01,
                1.03444363e-01,
                1.00000000e00,
                -3.07315718e-01,
                3.21010818e-01,
                -3.26343970e-01,
                -3.08905028e-01,
            ],
            [
                -3.46026704e-01,
                2.07036790e-02,
                1.38999676e-01,
                4.41423047e-01,
                6.37629814e-02,
                1.62805289e-01,
                2.86694276e-02,
                1.29289860e-01,
                -1.79570895e-01,
                1.55970174e-01,
                -1.64331465e-01,
                -8.23595422e-02,
                -9.45080414e-02,
                1.76337462e-01,
                2.84480391e-01,
                -3.07315718e-01,
                1.00000000e00,
                -2.20355666e-01,
                9.13139609e-02,
                2.05371011e-01,
            ],
            [
                1.63414758e-01,
                -2.49555102e-01,
                -1.14709293e-01,
                -2.27744028e-01,
                -1.84906916e-01,
                9.43020279e-02,
                -1.96550210e-01,
                -4.40312384e-01,
                2.16028037e-01,
                -1.42197171e-01,
                1.96232506e-01,
                3.83250002e-02,
                1.71282557e-01,
                -2.12190569e-01,
                -1.79624039e-01,
                3.21010818e-01,
                -2.20355666e-01,
                1.00000000e00,
                -2.70753402e-02,
                -3.24846049e-01,
            ],
            [
                -2.47552109e-01,
                3.62540942e-01,
                -1.01355483e-01,
                4.76617773e-02,
                3.48045991e-01,
                4.30958206e-01,
                8.78434377e-02,
                1.81368037e-01,
                -3.88521216e-01,
                -5.26129647e-02,
                -3.61849567e-01,
                -3.68925912e-01,
                -2.65462546e-01,
                -1.71906089e-01,
                1.01408053e-03,
                -3.26343970e-01,
                9.13139609e-02,
                -2.70753402e-02,
                1.00000000e00,
                2.19531016e-01,
            ],
            [
                -3.40912607e-01,
                2.20284497e-01,
                5.13063482e-02,
                4.58181374e-01,
                4.70362030e-01,
                6.99689991e-02,
                1.19392158e-01,
                2.65814422e-01,
                -3.15042467e-01,
                4.21461074e-01,
                5.49269654e-02,
                -1.84436096e-01,
                -3.73823778e-01,
                -8.55091437e-02,
                5.30854724e-02,
                -3.08905028e-01,
                2.05371011e-01,
                -3.24846049e-01,
                2.19531016e-01,
                1.00000000e00,
            ],
        ]
    )

    cov2 = np.array(
        [
            [
                1.00000000e00,
                -2.24875565e-01,
                5.90207711e-01,
                -2.35912704e-01,
                3.91183427e-01,
                2.83659132e-01,
                3.87562694e-02,
                3.46489144e-01,
                -5.48704248e-01,
                1.38625522e-01,
                -2.94492150e-01,
                -5.45663595e-02,
                -7.27184817e-02,
                -2.57405051e-01,
                -1.29699932e-01,
                -6.68657233e-02,
                -5.57551635e-01,
                3.86767196e-01,
                -3.00219451e-01,
                1.92819111e-01,
            ],
            [
                -2.24875565e-01,
                1.00000000e00,
                1.13128242e-01,
                2.84443090e-01,
                -3.62353505e-01,
                3.68236314e-01,
                3.86296506e-01,
                -3.90555947e-02,
                5.26309424e-01,
                -1.48287661e-01,
                3.45024098e-01,
                1.04629033e-02,
                5.32943731e-01,
                5.39693887e-01,
                4.01468780e-01,
                -1.43063754e-01,
                -2.40926277e-01,
                2.54265533e-01,
                5.81075045e-01,
                -1.21757256e-01,
            ],
            [
                5.90207711e-01,
                1.13128242e-01,
                1.00000000e00,
                2.00221102e-01,
                4.95217133e-01,
                6.71309536e-01,
                4.72547783e-01,
                3.84212323e-01,
                -1.74867152e-01,
                2.66384782e-04,
                1.18553880e-01,
                -6.02400693e-01,
                4.61710876e-01,
                4.25414566e-01,
                -8.31008680e-02,
                -1.10832614e-01,
                -9.56997513e-03,
                3.11979037e-01,
                -8.37846061e-02,
                -4.36858425e-01,
            ],
            [
                -2.35912704e-01,
                2.84443090e-01,
                2.00221102e-01,
                1.00000000e00,
                -7.31907050e-02,
                -1.84329871e-02,
                -1.20780749e-01,
                4.40481796e-01,
                2.22475234e-02,
                3.45400085e-01,
                2.74809111e-01,
                -4.65044745e-01,
                -7.72050663e-03,
                6.24681290e-01,
                5.67715175e-01,
                1.26167339e-01,
                1.88420407e-01,
                -1.99921540e-01,
                1.40187019e-01,
                -3.80071248e-01,
            ],
            [
                3.91183427e-01,
                -3.62353505e-01,
                4.95217133e-01,
                -7.31907050e-02,
                1.00000000e00,
                5.75477578e-01,
                3.18594071e-01,
                1.27298534e-01,
                -1.51012158e-01,
                -3.20465715e-01,
                2.19808653e-01,
                -6.16416181e-01,
                -1.50242044e-01,
                -1.15116958e-01,
                -1.62836173e-01,
                2.61309761e-01,
                -1.53003387e-01,
                7.33703285e-02,
                -3.90964203e-01,
                -2.53661465e-01,
            ],
            [
                2.83659132e-01,
                3.68236314e-01,
                6.71309536e-01,
                -1.84329871e-02,
                5.75477578e-01,
                1.00000000e00,
                6.33463910e-01,
                3.83119510e-02,
                1.90098439e-01,
                -3.71571680e-01,
                4.82061187e-01,
                -6.06048426e-01,
                5.25101057e-01,
                2.30282588e-01,
                -4.76207810e-02,
                -5.78590840e-02,
                -1.60083412e-01,
                4.15137829e-01,
                6.57220180e-02,
                -4.21682220e-01,
            ],
            [
                3.87562694e-02,
                3.86296506e-01,
                4.72547783e-01,
                -1.20780749e-01,
                3.18594071e-01,
                6.33463910e-01,
                1.00000000e00,
                -2.64041635e-01,
                5.93993157e-01,
                -4.44144954e-01,
                3.82086205e-01,
                -3.90473837e-01,
                5.25805070e-01,
                4.16954906e-01,
                -2.54092494e-01,
                -2.72903715e-01,
                2.10189308e-02,
                7.52525422e-02,
                -1.04836804e-02,
                -4.03288667e-01,
            ],
            [
                3.46489144e-01,
                -3.90555947e-02,
                3.84212323e-01,
                4.40481796e-01,
                1.27298534e-01,
                3.83119510e-02,
                -2.64041635e-01,
                1.00000000e00,
                -4.95378942e-01,
                2.82538352e-01,
                -2.23803754e-01,
                -1.71125494e-01,
                1.81379691e-02,
                1.21390816e-01,
                4.89790538e-01,
                5.79986691e-01,
                -1.27929380e-01,
                5.15201045e-01,
                4.10299435e-01,
                -3.14518946e-02,
            ],
            [
                -5.48704248e-01,
                5.26309424e-01,
                -1.74867152e-01,
                2.22475234e-02,
                -1.51012158e-01,
                1.90098439e-01,
                5.93993157e-01,
                -4.95378942e-01,
                1.00000000e00,
                -6.32961360e-01,
                2.23812801e-01,
                2.56910598e-02,
                4.46829855e-01,
                4.62363374e-01,
                1.68682674e-01,
                -8.92983196e-02,
                8.86586244e-02,
                -1.59506417e-01,
                2.92073110e-01,
                -6.43996980e-02,
            ],
            [
                1.38625522e-01,
                -1.48287661e-01,
                2.66384782e-04,
                3.45400085e-01,
                -3.20465715e-01,
                -3.71571680e-01,
                -4.44144954e-01,
                2.82538352e-01,
                -6.32961360e-01,
                1.00000000e00,
                2.30387644e-02,
                -3.74708957e-02,
                -2.89569354e-01,
                5.95826869e-02,
                -1.01643316e-01,
                -3.32976479e-01,
                2.11529045e-01,
                -2.14930182e-01,
                -2.10417695e-01,
                -2.25220529e-01,
            ],
            [
                -2.94492150e-01,
                3.45024098e-01,
                1.18553880e-01,
                2.74809111e-01,
                2.19808653e-01,
                4.82061187e-01,
                3.82086205e-01,
                -2.23803754e-01,
                2.23812801e-01,
                2.30387644e-02,
                1.00000000e00,
                -6.10385279e-01,
                8.59242700e-02,
                1.94309354e-01,
                -4.18782173e-03,
                -2.01369038e-01,
                2.08693267e-01,
                -1.21740529e-01,
                -1.78358615e-01,
                -6.47130451e-01,
            ],
            [
                -5.45663595e-02,
                1.04629033e-02,
                -6.02400693e-01,
                -4.65044745e-01,
                -6.16416181e-01,
                -6.06048426e-01,
                -3.90473837e-01,
                -1.71125494e-01,
                2.56910598e-02,
                -3.74708957e-02,
                -6.10385279e-01,
                1.00000000e00,
                -1.12291305e-01,
                -4.00247498e-01,
                3.75237812e-02,
                -1.32892682e-02,
                -3.11820465e-01,
                -1.57732068e-02,
                3.15469016e-01,
                7.32338825e-01,
            ],
            [
                -7.27184817e-02,
                5.32943731e-01,
                4.61710876e-01,
                -7.72050663e-03,
                -1.50242044e-01,
                5.25101057e-01,
                5.25805070e-01,
                1.81379691e-02,
                4.46829855e-01,
                -2.89569354e-01,
                8.59242700e-02,
                -1.12291305e-01,
                1.00000000e00,
                5.63039336e-01,
                -4.12501596e-02,
                -1.09322751e-01,
                1.85981007e-01,
                4.31604390e-01,
                4.85670800e-01,
                -3.04386044e-01,
            ],
            [
                -2.57405051e-01,
                5.39693887e-01,
                4.25414566e-01,
                6.24681290e-01,
                -1.15116958e-01,
                2.30282588e-01,
                4.16954906e-01,
                1.21390816e-01,
                4.62363374e-01,
                5.95826869e-02,
                1.94309354e-01,
                -4.00247498e-01,
                5.63039336e-01,
                1.00000000e00,
                2.70293109e-01,
                -1.54078189e-01,
                3.11516464e-01,
                -9.04412345e-02,
                2.67433640e-01,
                -4.86519490e-01,
            ],
            [
                -1.29699932e-01,
                4.01468780e-01,
                -8.31008680e-02,
                5.67715175e-01,
                -1.62836173e-01,
                -4.76207810e-02,
                -2.54092494e-01,
                4.89790538e-01,
                1.68682674e-01,
                -1.01643316e-01,
                -4.18782173e-03,
                3.75237812e-02,
                -4.12501596e-02,
                2.70293109e-01,
                1.00000000e00,
                4.94393183e-01,
                -2.56574259e-01,
                1.83523368e-01,
                5.50826593e-01,
                1.08304249e-01,
            ],
            [
                -6.68657233e-02,
                -1.43063754e-01,
                -1.10832614e-01,
                1.26167339e-01,
                2.61309761e-01,
                -5.78590840e-02,
                -2.72903715e-01,
                5.79986691e-01,
                -8.92983196e-02,
                -3.32976479e-01,
                -2.01369038e-01,
                -1.32892682e-02,
                -1.09322751e-01,
                -1.54078189e-01,
                4.94393183e-01,
                1.00000000e00,
                -1.92171686e-01,
                5.02109084e-01,
                4.23847482e-01,
                1.53991862e-01,
            ],
            [
                -5.57551635e-01,
                -2.40926277e-01,
                -9.56997513e-03,
                1.88420407e-01,
                -1.53003387e-01,
                -1.60083412e-01,
                2.10189308e-02,
                -1.27929380e-01,
                8.86586244e-02,
                2.11529045e-01,
                2.08693267e-01,
                -3.11820465e-01,
                1.85981007e-01,
                3.11516464e-01,
                -2.56574259e-01,
                -1.92171686e-01,
                1.00000000e00,
                -3.83736856e-01,
                -6.20068418e-02,
                -5.76308130e-01,
            ],
            [
                3.86767196e-01,
                2.54265533e-01,
                3.11979037e-01,
                -1.99921540e-01,
                7.33703285e-02,
                4.15137829e-01,
                7.52525422e-02,
                5.15201045e-01,
                -1.59506417e-01,
                -2.14930182e-01,
                -1.21740529e-01,
                -1.57732068e-02,
                4.31604390e-01,
                -9.04412345e-02,
                1.83523368e-01,
                5.02109084e-01,
                -3.83736856e-01,
                1.00000000e00,
                4.81301565e-01,
                1.10394394e-01,
            ],
            [
                -3.00219451e-01,
                5.81075045e-01,
                -8.37846061e-02,
                1.40187019e-01,
                -3.90964203e-01,
                6.57220180e-02,
                -1.04836804e-02,
                4.10299435e-01,
                2.92073110e-01,
                -2.10417695e-01,
                -1.78358615e-01,
                3.15469016e-01,
                4.85670800e-01,
                2.67433640e-01,
                5.50826593e-01,
                4.23847482e-01,
                -6.20068418e-02,
                4.81301565e-01,
                1.00000000e00,
                9.77728034e-02,
            ],
            [
                1.92819111e-01,
                -1.21757256e-01,
                -4.36858425e-01,
                -3.80071248e-01,
                -2.53661465e-01,
                -4.21682220e-01,
                -4.03288667e-01,
                -3.14518946e-02,
                -6.43996980e-02,
                -2.25220529e-01,
                -6.47130451e-01,
                7.32338825e-01,
                -3.04386044e-01,
                -4.86519490e-01,
                1.08304249e-01,
                1.53991862e-01,
                -5.76308130e-01,
                1.10394394e-01,
                9.77728034e-02,
                1.00000000e00,
            ],
        ]
    )
    mean1 = np.array(
        [
            0.01679265,
            0.18359236,
            0.20564086,
            0.23114308,
            0.58543958,
            0.6947906,
            0.0788281,
            0.40043064,
            0.93256113,
            0.49376815,
            0.69878371,
            0.3656201,
            0.18253211,
            0.03291595,
            0.75851497,
            0.07549631,
            0.31401175,
            0.42941007,
            0.38633513,
            0.40352032,
        ]
    )
    mean2 = np.array(
        [
            0.7419362,
            0.54864325,
            0.49792891,
            0.55749687,
            0.44171731,
            0.28422682,
            0.5677138,
            0.37751754,
            0.59658611,
            0.48413516,
            0.46357047,
            0.03467703,
            0.6784318,
            0.28710207,
            0.00611792,
            0.19883307,
            0.46648865,
            0.16173271,
            0.86396507,
            0.8286345,
        ]
    )
    return mean1, mean2, cov1, cov2


def main():
    m1, m2, c1, c2 = mvnorm_params()
    mv = Multinormalpdfs(dim=20, means=[m1, m2], covmats=[c1, c2])
    # mv = Branin30()
    # mv = Hartmann(dim=25)
    inputs = mv.domain.inputs.get_keys()

    Ninit = 20
    Niter = 50
    Nrepeats = 5
    all_opt_runs = []

    for irep in range(Nrepeats):
        sampler = strats.map(RandomStrategy(domain=mv.domain))
        init_data = sampler.ask(Ninit)
        opt_data = pd.concat([init_data, mv.f(init_data[inputs])], axis=1)
        opt_data["phase"] = "init"
        optimizer = strats.map(SoboStrategy(domain=mv.domain))
        optimizer.tell(opt_data)
        for _ in trange(Niter):
            query = optimizer.ask(1)
            new_data = pd.concat([query, mv.f(query[inputs])], axis=1)
            new_data["phase"] = "opt"
            optimizer.tell(new_data)
            opt_data = pd.concat([opt_data, new_data])
        opt_data["iter"] = range(len(opt_data))
        opt_data["run"] = irep
        all_opt_runs.append(opt_data)

    all_opt_runs = pd.concat(all_opt_runs)
    all_opt_runs.to_csv("mnorm_short_sobo.csv", index=False)


if __name__ == "__main__":
    main()
